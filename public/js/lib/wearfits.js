!function(e){"use strict";var t,n,a,o,r,i,s,c,l,d,m,u,h,g,p="";p="https://demo.wearfits.com:3000";var v,E,f,b,T,w,y=document.createElement("div"),R=document.createElement("div"),H=document.createElement("div"),_=document.createElement("div"),x=document.createElement("div"),M=document.createElement("div"),L="light",k=.9,S=new THREE.Vector3(0,k,0),j=new THREE.Vector3(0,1.5,2.3),C=new THREE.Vector3(0,1.5,-2.3),V=new THREE.MeshStandardMaterial({color:16777215,roughness:.9,metalness:.08,emissive:0,skinning:!0}),I=new THREE.Color(16777215),A=j.distanceTo(S),P=!1,B=!1,F=2,W=1,z=!1,O=!0,D=!1,N=!0,U=!1,G=!1,q=new THREE.MeshBasicMaterial({side:THREE.DoubleSide,transparent:!0,vertexColors:THREE.FaceColors}),J=(new THREE.MeshBasicMaterial({side:THREE.DoubleSide,transparent:!0,morphTargets:!0,vertexColors:THREE.FaceColors}),[]),K={},Q=[{}],X=[{}],$=new THREE.Clock,Y=(new Date).getTime(),Z=0,ee=0,te=0,ne=null,ae=function(){return!(!K.object||!K.action)},oe=function(e=0){return!(!Q[e].object||Q[e].object.morphTargetInfluences)},re=function(e=0){return!(!Q[e].object||!Q[e].object.morphTargetInfluences)},ie=function(e){if(e&&(o.remove(e),e.isMesh))if(e.geometry.dispose(),Array.isArray(e.material))for(var t of e.material)t.dispose(),t.map&&t.map.dispose();else e.material.dispose(),e.material.map&&e.material.map.dispose()},se=function(e=0){Q[e]&&(ie(Q[e].object),Q[e]===X[e]&&delete X[e].object,delete Q[e].object)},ce=function(){ie(K.object),delete K.object},le=function(){for(var e of(clearTimeout(T),ae()&&!oe()&&(K.action.time=8/24,K.action.paused=0,K.action.play()),Q))e.action&&(e.action.time=0,e.action.paused=0,e.action.play()),we()},de=function(e,t=!0){console.log("Quality set to "+e),_.classList.remove("active_button"),x.classList.remove("active_button"),M.classList.remove("active_button");var n=z;switch(W=1,z=!1,O=!1,e){case 1:_.classList.add("active_button");break;case 2:x.classList.add("active_button"),W=window.devicePixelRatio>2?2:window.devicePixelRatio,O=!0;break;case 3:W=window.devicePixelRatio>2?2:window.devicePixelRatio,O=!0,z=!0;break;case 4:M.classList.add("active_button"),W=2,O=!0,z=!0;break;default:console.log("Quality mode error!"),F=1}z!==n&&t&&Ae(),r&&r.setPixelRatio(W),F=e,localStorage.quality=e},me=function(){for(var e of(ae()&&(K.action.time=8/24,K.action.paused=1,K.action.play()),Q))e.action&&(e.action.time=0,e.action.paused=1,e.action.play())},ue=function(e){t.radius=A,k=.9,t.target.y=.9,1===e&&xe(j),2===e&&xe(new THREE.Vector3(3,1.5,0)),3===e&&xe(new THREE.Vector3(0,4,0)),4===e&&xe(C),5===e&&xe(new THREE.Vector3(-3,1.5,0)),6===e&&xe(new THREE.Vector3(0,-3,0)),7===e&&xe(new THREE.Vector3(1,1.5,3)),8===e&&ve(),9===e&&xe(new THREE.Vector3(0,0,0))},he=function(e){switch(e=e.toLowerCase(),o.background=new THREE.Color(16777215),i.emissive=1118481,u.material.color=new THREE.Color(14737632),s.intensity=.65,(ne=new THREE.DataTexture(new Uint8Array(Array(48).fill(255)),4,4,THREE.RGBFormat)).mapping=THREE.SphericalReflectionMapping,ne.needsUpdate=!0,e){case"light":break;case"dark":o.background=new THREE.Color(1118481),i.emissive=0,u.material.color=new THREE.Color(8421504),s.intensity=.45,ne=null;break;case"bridge":var t=p+"/assets/threejs/",n=(new THREE.CubeTextureLoader).load([t+"posx.jpg",t+"negx.jpg",t+"posy.jpg",t+"negy.jpg",t+"posz.jpg",t+"negz.jpg"],e=>{});o.background=n,i.emissive=0,V.color=new THREE.Color(16777215),V.roughness=.1,V.metalness=.05,ne=o.background}for(var a of Q)if(a.object)for(var r=0;r<a.object.material.length;r++)a.object.material[r].envMap=ne,a.object.material[r].needsUpdate=!0;V.envMap=o.background.isColor?null:o.background,V.needsUpdate=!0,L=e},ge=function(){clearTimeout(w),t.autoRotate=!1},pe=function(e){U&&(w=setTimeout(function(){t.autoRotate=!0},e))},ve=function(){if(n.position.distanceTo(j)>n.position.distanceTo(C))var e=j;else e=C;var t=new THREE.Vector3(2*(Math.sign(n.position.x)||1)*Math.abs(e.z),e.y,0);xe(e,t)},Ee=function(e=y){B=!B,localStorage.shadows=B,Ae()},fe=function(e=y){P=!P,localStorage.enableVR=P,setTimeout(function(){window.location.reload()},100)},be=function(e,t){var n;e.xhr=t,R.style.visibility="visible",n=t.lengthComputable?t.total:4*parseInt(t.target.getResponseHeader("Content-Length")),H.innerHTML=n?Math.min(100,Math.round(t.loaded/n*100))+" %":Math.round(t.loaded/1e3)+" KB"},Te=function(e,t){R.style.visibility="hidden",e&&e(t)},we=function(){},ye=function(){T=setTimeout(()=>le(),2e3)},Re=function(e,t){for(var n of(H.innerHTML="Loading textures ...",e.object.material))if(n.map&&!n.map.image)return void setTimeout(function(){Re(e,t)},20);e.object.name="garment",R.style.visibility="hidden",se(e.index),Q[e.index]=e,Se(e.object,!0),o.add(e.object),re()?setTimeout(function(){le()},20):(xe(j),me()),G&&Me(),t&&t(),clearTimeout(b),b=setTimeout(()=>{Q[e.index].isLoading=!1},1e3)},He=function(){X[0].object&&!X[0].isLoading?ee>57&&1==F?(de(2),setTimeout(He,2e3)):ee>58&&2==F&&!D?(de(3),setTimeout(He,2e3)):ee>58&&3==F&&!D&&de(4):setTimeout(He,3e3)},_e=function(){a.aspect=h.offsetWidth/h.offsetHeight,a.updateProjectionMatrix(),r.setSize(h.offsetWidth,h.offsetHeight,!1)},xe=function(e,t){ge(),te=20,t?(E=t,f=e):(E=e,f=void 0)},Me=function(){q.morphTargets=re(),q.needsUpdate=!0;var e=0;for(var t of Q)if(t.object)for(let n=0;n<t.object.material.length;n++)J[e]=t.object.material[n],t.object.material[n]=q,e++},Le=function(){var e=0;for(var t of Q)if(t.object)for(let n=0;n<t.object.material.length;n++)t.object.material[n]=J[e],e++},ke=function(e,t,n){var a=e.material[n];if(a.type!==t){var o={map:a.map,envMap:a.envMap,bumpMap:a.bumpMap,normalMap:a.normalMap,color:a.color,emissive:a.emissive,morphTargets:a.morphTargets,morphNormals:a.morphNormals,skinning:a.skinning,transparent:a.transparent,side:a.side,vertexColors:a.vertexColors},r=THREE[t];return e.material[n]=new r(o),e.material[n].roughness=void 0!==a.roughness?a.roughness:Math.max(0,(100-a.shininess)/100),e.material[n].metalness=void 0!==a.metalness?a.metalness:a.specular.r,e.material[n].shininess=void 0!==a.shininess?a.shininess:100*(1-a.roughness),e.material[n].specular=void 0!==a.specular?a.specular:{r:a.metalness,g:a.metalness,b:a.metalness},e.material[n]}},Se=function(e,t=!1){if(e.frustumCulled=!1,e.castShadow=!0,e.receiveShadow=!1,t||(e.material=V),Array.isArray(e.material)||(e.material=[e.material],e.geometry.addGroup(0,1/0,0)),t)for(var n=0;n<e.material.length;n++)ke(e,"MeshStandardMaterial",n);for(n=0;n<e.material.length;n++){var a=e.material[n];for(var r in a.side=THREE.DoubleSide,a.vertexColors=THREE.NoColors,a.needsUpdate=!0,a)r.toLowerCase().endsWith("map")&&a[r]&&(a[r].encoding=THREE.LinearEncoding,a[r].wrapS=a[r].wrapT=THREE.RepeatWrapping);a.normalMap&&(a.side=THREE.FrontSide),a.envMap=t?ne:o.background.isColor?null:o.background}},je=function(e){var t=document.getElementById("garment_average_strain")||document.createElement("div"),n=document.getElementById("garment_percent_very_stretched")||document.createElement("div"),a=document.getElementById("garment_total_very_stretched")||document.createElement("div"),o=document.getElementById("garment_percent_stretched")||document.createElement("div"),r=document.getElementById("garment_total_stretched")||document.createElement("div");r.innerHTML=e.total_stretched;var i=document.getElementById("garment_percent_little_stretched")||document.createElement("div"),s=document.getElementById("garment_total_little_stretched")||document.createElement("div"),c=document.getElementById("garment_percent_compressed")||document.createElement("div"),l=(document.getElementById("garment_total_compressed")||document.createElement("div"),document.getElementById("garment_fit")||document.createElement("div"));t.innerHTML="--",n.innerHTML="--",a.innerHTML="--",o.innerHTML="--",r.innerHTML="--",i.innerHTML="--",s.innerHTML="--",c.innerHTML="--",l.innerHTML="run simulation",void 0!==e.strain_areas&&(garment.strain_triangle_areas=e.strain_areas),void 0!==e.average_strain&&(garment.average_strain=e.average_strain,t.innerHTML=Math.round(1e3*e.average_strain)/1e3),void 0!==e.percent_very_stretched&&(n.innerHTML=Math.round(1e3*e.percent_very_stretched)/1e3),void 0!==e.total_very_stretched&&(a.innerHTML=Math.round(1e3*e.total_very_stretched)/1e3),void 0!==e.percent_stretched&&(o.innerHTML=Math.round(1e3*e.percent_stretched)/1e3),void 0!==e.total_stretched&&(r.innerHTML=Math.round(1e3*e.total_stretched)/1e3),void 0!==e.percent_little_stretched&&(i.innerHTML=Math.round(1e3*e.percent_little_stretched)/1e3),void 0!==e.total_little_stretched&&(s.innerHTML=Math.round(1e3*e.total_little_stretched)/1e3),void 0!==e.percent_compressed&&(c.innerHTML=Math.round(1e3*e.percent_compressed)/1e3,l.innerHTML="it's OK")},Ce=function(e,t,n=!1,a=0,o=!1){return new Promise(function(r,i){if(function(e=0){var t=X[e].xhr;t&&t.target&&t.target.abort&&t.target.abort()}(a),Q[a]&&Q[a].object&&Q[a].hash===e&&Q[a].id===t&&(!oe(a)||!n))return console.log((n?"Animation":"Preview")+" already loaded "+e+" "+t),void r();clearTimeout(b);var s={hash:e,url:p+"/cache/"+e+"/"+t+(n?"":"_preview")+".json",isLoading:!0,id:t,index:a,isAnimation:n};X[a]=s;var c=new THREE.JSONLoader;c.setResourcePath(p+"/assets/textures/"),c.load(s.url,(a,i)=>{H.innerHTML="Processing ...",setTimeout(function(){for(var c of(a.computeVertexNormals(),i))c.morphTargets=n,c.morphNormals=O&&n;var l,d,m=(new THREE.BufferGeometry).fromGeometry(a);if(n&&O&&function(e,t){var n,a,o,r=new THREE.Vector3,i=new THREE.Vector3,s=new Array(t.vertices.length);for(let e=0,n=t.vertices.length;e<n;e++)s[e]=new THREE.Vector3;e.morphAttributes.normal=[];for(let m=0,u=t.morphTargets.length;m<u;m++){for(let e=0,n=t.vertices.length;e<n;e++)s[e].x=0,s[e].y=0,s[e].z=0;for(let e=0,c=t.faces.length;e<c;e++){let c=t.faces[e];n=t.morphTargets[m].vertices[c.a],a=t.morphTargets[m].vertices[c.b],o=t.morphTargets[m].vertices[c.c],r.subVectors(o,a),i.subVectors(n,a),r.cross(i),s[c.a].add(r),s[c.b].add(r),s[c.c].add(r)}for(let e=0,n=t.faces.length;e<n;e++){let n=t.faces[e];Math.abs(s[n.a].dot(s[n.b]))>1e-5&&(s[n.a].x=1,s[n.a].y=1,s[n.a].z=1,s[n.b].x=1,s[n.b].y=1,s[n.b].z=1,s[n.c].x=1,s[n.c].y=1,s[n.c].z=1)}for(let e=0,n=t.morphTargets[m].vertices.length;e<n;e++)s[e].normalize();var c=new Float32Array(9*t.faces.length),l=0;for(let e=0,n=t.faces.length;e<n;e++){let n=t.faces[e];c[l++]=s[n.a].x,c[l++]=s[n.a].y,c[l++]=s[n.a].z,c[l++]=s[n.b].x,c[l++]=s[n.b].y,c[l++]=s[n.b].z,c[l++]=s[n.c].x,c[l++]=s[n.c].y,c[l++]=s[n.c].z}var d=new THREE.Float32BufferAttribute(9*t.faces.length,3);d.name="",d.array=c,e.morphAttributes.normal.push(d)}}(m,a),a.dispose(),s.object=new THREE.Mesh(m,i),s.object.visible=!o,n&&a.animations&&a.animations.length>0){a.animations[0].name="";for(var u=0;u<a.animations[0].tracks.length;u++)a.animations[0].tracks[u].name=".morphTargetInfluences["+u+"]";a.animations[0].tracks[a.animations[0].tracks.length-1].values[3]=1,s.mixer=new THREE.AnimationMixer(s.object),s.action=s.mixer.clipAction(a.animations[0]),s.action.setDuration(1*a.animations[0].tracks.length/24),s.action.clampWhenFinished=!0,s.action.loop=THREE.LoopOnce,me()}l=[p,"cache",e,t+"_metadata.json"].join("/"),(d=new XMLHttpRequest).onload=(e=>{if(d.status>=200&&d.status<400){var t=JSON.parse(d.responseText);je(t)}}),d.open("get",l,!0),d.send(),function(e,t){return new Promise(function(n,a){var o=new XMLHttpRequest;o.onload=(t=>{if(o.status>=200&&o.status<400){console.log("Loaded custom material");for(var a=JSON.parse(o.responseText),r=0;r<a.length;++r){var i=a[r];for(var s in i.type&&ke(e.object,i.type,r),i){var c=i[s];if(c)if(s.toLowerCase().endsWith("map")){var l=(new THREE.TextureLoader).load(p+"/assets/textures/"+c,e=>{});e.object.material[r][s]=l}else Array.isArray(c)?e.object.material[r][s]=new THREE.Color(c[0],c[1],c[2]):e.object.material[r][s]=c}}}n()}),o.open("get",t,!0),o.send()})}(s,[p,"assets/materials",t.split("_")[0]+".json"].join("/")).then(()=>Re(s,r))},10)},be.bind(null,s),Te.bind(null,i))})},Ve=function(){for(var e of Q)Ce(e.hash,e.id,!0,e.index)},Ie=function(e,t){return new Promise(function(n,a){K.object&&K.hash===e?n():(K.hash=e,K.url=p+"/cache/"+e+"/avatar.gltf",(new THREE.GLTFLoader).load(K.url,e=>{R.style.visibility="hidden",ce(),e.scene.updateMatrixWorld(),e.scene.traverse(e=>{if("avatar_skeleton"===e.name&&(K.skeleton=e),"avatar"===e.name&&(K.object=e),e.name.startsWith("avatar_skeleton_pelvis")&&e.isBone&&(v=e),"avatar_skeleton_toes_R"===e.name&&i){var t=new THREE.Vector3;e.getWorldPosition(t),i.position.y=t.y-.01}}),Se(K.object),t&&(K.object.visible=!1),o.add(K.object),K.mixer=new THREE.AnimationMixer(e.scene),K.action=K.mixer.clipAction(e.animations[0]),K.action.loop=THREE.LoopOnce,K.action.clampWhenFinished=!0,K.mixer.addEventListener("finished",ye),me(),n()},be.bind(null,K),Te.bind(null,a)))})},Ae=function(){r&&(r.forceContextLoss(),r.context=null,r.domElement=null),(r=new THREE.WebGLRenderer({antialias:z})).shadowMap.enabled=B,r.shadowMap.type=THREE.PCFSoftShadowMap,r.setSize(h.offsetWidth,h.offsetHeight,!1),r.setPixelRatio(W),r.vr.enabled=P,h.innerHTML="",h.appendChild(r.domElement),(g=h.getElementsByTagName("canvas")[0]).style.width="100%",g.style.height="100%",e.renderer=r,e.canvas=g},Pe=function(){if(requestAnimationFrame(Pe),!e.pauseRendering){var i=$.getDelta();for(var s of(K.mixer&&K.mixer.update(i),Q))s.mixer&&s.mixer.update(i);te>0&&(1===te&&pe(1e3),te-=1,n.position.lerp(E,.3),f&&E.lerp(f,.3)),v&&((k-=k-t.target.y)>1.5&&(k=1.5),k<.5&&(k=.5),v.getWorldPosition(S),u&&(u.position.x=-S.x,u.position.y=S.z),!P&&N&&(S.y=k,t.target=S,n.lookAt(S))),t.update(),r.render(o,a),Z+=1,(new Date).getTime()-Y>=1e3&&(Y=(new Date).getTime(),ee=Z,e.displayFps&&console.log(ee),Z=0)}},Be=function(){!function(){if(!function(){try{return!!window.WebGLRenderingContext&&!!document.createElement("canvas").getContext("experimental-webgl")}catch(e){return!1}}())throw console.log("WebGL error"),toggle3DView(!1),"WebGL not supported!"}(),/Android|webOS|iPhone|iPad|iPod|Opera Mini/i.test(navigator.userAgent)?(D=!0,F=1):(D=!1,F=2),window.localStorage?(localStorage.quality&&(F=parseInt(localStorage.quality)),localStorage.enableVR&&(P="true"==localStorage.enableVR),localStorage.shadows&&(B="true"==localStorage.shadows)):window.localStorage={},function(){var g=(new Date).getTime();(h=document.getElementById("wearfits_viewer")).style.cursor="grab",(o=new THREE.Scene).background=I,(a=new THREE.PerspectiveCamera(45,window.innerWidth/window.innerHeight,.01,100)).position.set(0,0,0),e.camera=a,(n=new THREE.PerspectiveCamera).position.copy(j),n.add(a),n.name="user",o.add(n),THREE.OrbitControls?(t=new THREE.OrbitControls(n,h),n.position.copy(j),t.screenSpacePanning=!0,t.enableKeys=!1,t.autoRotate=U,t.autoRotateSpeed=8,t.minPolarAngle=.2*Math.PI,t.maxPolarAngle=.55*Math.PI,t.maxDistance=4,t.minDistance=.5,t.target.copy(S),t.radius=A,t.update(),t.addEventListener("start",ge),t.addEventListener("end",pe.bind(null,1e3))):t={target:{y:k}},e.controls=t,s=new THREE.AmbientLight(16777215,.65),o.add(s);(c=new THREE.SpotLight(16777215,.2*.4)).castShadow=!0,c.position.set(4,10,0),c.shadow.mapSize.width=2048,c.shadow.mapSize.height=2048,c.shadow.bias=-1e-4,c.name="TOP",o.add(c),(l=new THREE.SpotLight(16777215,.8*.4)).position.set(10,3,10),l.name="KEY",o.add(l),(d=new THREE.SpotLight(16777215,.12)).position.set(-10,3,10),d.name="FILL",o.add(d),(m=new THREE.SpotLight(16777215,.8*.4)).position.set(-10,3,-10),m.name="BACK",o.add(m);for(var p=new Uint8Array(16777216),v=0;v<2048;v++)for(var E=0;E<2048;E++){var f=2048*v*4+4*E,b=Math.sqrt(Math.pow(v-1024,2)+Math.pow(E-1024,2));b>1024&&(b=1024);var T=Math.floor(5*Math.random()+1);p[f]=255,p[f+1]=255,p[f+2]=255,p[f+3]=(1024-b)/1024*220+T}var w=new THREE.DataTexture(p,2048,2048,THREE.RGBAFormat);w.needsUpdate=!0,(i=new THREE.Mesh(new THREE.PlaneBufferGeometry(7,7),new THREE.MeshStandardMaterial({map:w,roughness:1,metalness:0,emissive:1118481,transparent:!0}))).rotation.x=-Math.PI/2,i.rotation.z=-Math.PI,i.receiveShadow=!0,i.name="ground",o.add(i),(u=new THREE.Mesh(new THREE.PlaneBufferGeometry(.9,.9),new THREE.MeshBasicMaterial({map:w,color:14737632,transparent:!0}))).renderOrder=1,u.position.z=.002,u.name="shadow",i.add(u),he(L),de(F,!1),Ae(),P&&window.WEBVR&&document.body.appendChild(WEBVR.createButton(r)),window.addEventListener("resize",_e,!1),console.log("Init scene: "+((new Date).getTime()-g)/1e3+" s"),e.scene=o,r.render(o,a)}(),Pe(),setTimeout(He,5e3),R=document.getElementById("loader"),H=document.getElementById("loader_info"),R||((R=document.createElement("div")).style.position="absolute",R.style.visibility="hidden",R.style.left="20px",R.style.bottom="20px",h.appendChild(R),(H=document.createElement("div")).style.font="20px Helvetica, Arial",R.appendChild(H)),(_=document.getElementById("low_mode_button")||document.createElement("div")).onclick=de.bind(null,1),1==F&&_.classList.add("active_button"),(x=document.getElementById("high_mode_button")||document.createElement("div")).onclick=de.bind(null,2),2==F&&x.classList.add("active_button"),(M=document.getElementById("ultra_mode_button")||document.createElement("div")).onclick=de.bind(null,4),4==F&&M.classList.add("active_button"),window.vr_mode_button&&(vr_mode_button.onclick=fe,("getVRDisplays"in navigator||"xr"in navigator||P)&&(vr_mode_button.style.display="block"),P&&vr_mode_button.classList.add("active_button")),window.toggle_shadows&&(toggle_shadows.onclick=Ee,B&&(toggle_shadows.checked=!0)),document.addEventListener("keydown",function(e){if(/^[wsad]$/.test(e.key)){var o=new THREE.Matrix4,r=P?a:n;o.extractRotation(r.matrix);var i=new THREE.Vector3(0,0,1);o.multiplyVector3(i);var s=i;"w"===e.key&&s.multiplyScalar(-.1),"s"===e.key&&s.multiplyScalar(.1),"a"===e.key&&(s=(new THREE.Vector3).crossVectors(new THREE.Vector3(0,1,0),i).normalize().multiplyScalar(-.1)),"d"===e.key&&(s=(new THREE.Vector3).crossVectors(new THREE.Vector3(0,1,0),i).normalize().multiplyScalar(.1)),n.position.add(s),t.target.add(s),e.preventDefault()}}),document.addEventListener("keypress",function(e){" "===e.key&&(document.getElementById("replay_button").click(),e.preventDefault()),/^[0-9]$/.test(e.key)&&(ue(parseInt(e.key)),e.preventDefault())})};(document.attachEvent?"complete"===document.readyState:"loading"!==document.readyState)?Be():document.addEventListener("DOMContentLoaded",Be),e.loadAvatar=Ie,e.loadGarment=Ce,e.loadAnimation=Ve,e.load=function(e,t){K.object&&(K.object.visible=!1);for(var n=0;n<Q.length;++n)Q[n].object&&(Q[n].object.visible=!1),n>=t.length&&se(n);Array.isArray(t)||(t=[t]);var a=[];a.push(Ie(e,!0));for(n=0;n<t.length;++n)a.push(Ce(e,t[n],!1,n,!0));Promise.all(a).then(function(e){for(var t of(K.object.visible=!0,Q))t.object&&(t.object.visible=!0);Ve()})},e.isPreview=oe,e.isAnimation=re,e.removeGarment=se,e.clearScene=function(){ce();for(var e=0;e<Q.length;++e)se(e)},e.canvasResize=_e,e.replay=le,e.setCameraPosition=ue,e.toggleStrainMap=function(e=y){(G=!G)?(Me(),e.classList.add("active_button")):(Le(),e.classList.remove("active_button"))},e.toggleFrontBack=ve,e.toggleShadows=Ee,e.toggleLockCamera=function(e=y){t.target=t.target.clone(),N=!N},e.toggleFullScreen=function(e=y){document.fullScreenElement&&null!==document.fullScreenElement||document.mozFullScreen||document.webkitIsFullScreen?(document.cancelFullScreen||document.webkitCancelFullScreen||document.mozCancelFullScreen||document.exitFullscreen).call(document):(document.body.requestFullScreen||document.body.webkitRequestFullScreen||document.body.mozRequestFullScreen||document.body.msRequestFullScreen).call(document.body)},e.toggleRotation=function(e=y){U=!U,t.autoRotate=U,U?e.classList.add("active_button"):e.classList.remove("active_button")},e.toggleVRMode=fe,e.toggleZoom=function(e=y){Q[0].object.geometry.computeBoundingBox();var o=Q[0].object.geometry.boundingBox,r=o.max.y-o.min.y,i=a.fov*(Math.PI/180),s=Math.abs(r/2/Math.tan(i/2));n.position.distanceTo(S)>(A+s)/2?(k=(o.min.y+o.max.y)/2,t.target.y=k,t.radius=s):(k=.9,t.target.y=k,t.radius=A)},e.toggleTheme=function(e=y){"light"===L?(he("dark"),e.classList.add("active_button")):(he("light"),e.classList.remove("active_button"))},e.downloadAR=function(){if(X[0].id){var e=document.createElement("a");e.setAttribute("href",p+"/cache/"+X[0].hash+"/"+X[0].id+".usdz"),e.setAttribute("rel","ar"),e.style.display="none",e.appendChild(document.createElement("img")),e.style.display="none",document.body.appendChild(e),e.click(),document.body.removeChild(e)}else alert("Select garment first")},e.setQuality=de,e.setTheme=he,e.converMaterial=ke,e.avatar=K,e.garments=Q,e.origin=p,e.pauseRendering=!1,e.displayFps=!1,e.test=function(){for(var e of(Q[1].object.renderOrder=-5,Q[1].object.material))e.depthWrite=!1,e.depthFunc=2,e.side=0}}(this.wearfits={}),THREE.JSONLoader=function(){function e(e){"boolean"==typeof e&&(console.warn("THREE.JSONLoader: showStatus parameter has been removed from constructor."),e=void 0),this.manager=void 0!==e?e:THREE.DefaultLoadingManager,this.withCredentials=!1}return Object.assign(e.prototype,{crossOrigin:"anonymous",load:function(e,t,n,a){var o=this,r=void 0===this.path?THREE.LoaderUtils.extractUrlBase(e):this.path,i=new THREE.FileLoader(this.manager);i.setPath(this.path),i.setWithCredentials(this.withCredentials),i.load(e,function(n){var a=JSON.parse(n),i=a.metadata;if(void 0!==i){var s=i.type;if(void 0!==s&&"object"===s.toLowerCase())return void console.error("THREE.JSONLoader: "+e+" should be loaded with THREE.ObjectLoader instead.")}var c=o.parse(a,r);t(c.geometry,c.materials)},n,a)},setPath:function(e){return this.path=e,this},setResourcePath:function(e){return this.resourcePath=e,this},setCrossOrigin:function(e){return this.crossOrigin=e,this},parse:function(){return function(e,t){void 0!==e.data&&(e=e.data),void 0!==e.scale?e.scale=1/e.scale:e.scale=1;var n=new THREE.Geometry;return function(e,t){function n(e,t){return e&1<<t}var a,o,r,i,s,c,l,d,m,u,h,g,p,v,E,f,b,T,w,y,R,H,_,x,M,L,k,S=e.faces,j=e.vertices,C=e.normals,V=e.colors,I=e.scale,A=0;if(void 0!==e.uvs){for(a=0;a<e.uvs.length;a++)e.uvs[a].length&&A++;for(a=0;a<A;a++)t.faceVertexUvs[a]=[]}for(i=0,s=j.length;i<s;)(T=new THREE.Vector3).x=j[i++]*I,T.y=j[i++]*I,T.z=j[i++]*I,t.vertices.push(T);for(i=0,s=S.length;i<s;)if(h=n(u=S[i++],0),g=n(u,1),p=n(u,3),v=n(u,4),E=n(u,5),f=n(u,6),b=n(u,7),h){if((y=new THREE.Face3).a=S[i],y.b=S[i+1],y.c=S[i+3],(R=new THREE.Face3).a=S[i+1],R.b=S[i+2],R.c=S[i+3],i+=4,g&&(m=S[i++],y.materialIndex=m,R.materialIndex=m),r=t.faces.length,p)for(a=0;a<A;a++)for(x=e.uvs[a],t.faceVertexUvs[a][r]=[],t.faceVertexUvs[a][r+1]=[],o=0;o<4;o++)L=x[2*(d=S[i++])],k=x[2*d+1],M=new THREE.Vector2(L,k),2!==o&&t.faceVertexUvs[a][r].push(M),0!==o&&t.faceVertexUvs[a][r+1].push(M);if(v&&(l=3*S[i++],y.normal.set(C[l++],C[l++],C[l]),R.normal.copy(y.normal)),E)for(a=0;a<4;a++)l=3*S[i++],_=new THREE.Vector3(C[l++],C[l++],C[l]),2!==a&&y.vertexNormals.push(_),0!==a&&R.vertexNormals.push(_);if(f&&(H=V[c=S[i++]],y.color.setHex(H),R.color.setHex(H)),b)for(a=0;a<4;a++)H=V[c=S[i++]],2!==a&&y.vertexColors.push(new THREE.Color(H)),0!==a&&R.vertexColors.push(new THREE.Color(H));t.faces.push(y),t.faces.push(R)}else{if((w=new THREE.Face3).a=S[i++],w.b=S[i++],w.c=S[i++],g&&(m=S[i++],w.materialIndex=m),r=t.faces.length,p)for(a=0;a<A;a++)for(x=e.uvs[a],t.faceVertexUvs[a][r]=[],o=0;o<3;o++)L=x[2*(d=S[i++])],k=x[2*d+1],M=new THREE.Vector2(L,k),t.faceVertexUvs[a][r].push(M);if(v&&(l=3*S[i++],w.normal.set(C[l++],C[l++],C[l])),E)for(a=0;a<3;a++)l=3*S[i++],_=new THREE.Vector3(C[l++],C[l++],C[l]),w.vertexNormals.push(_);if(f&&(c=S[i++],w.color.setHex(V[c])),b)for(a=0;a<3;a++)c=S[i++],w.vertexColors.push(new THREE.Color(V[c]));t.faces.push(w)}}(e,n),function(e,t){var n=void 0!==e.influencesPerVertex?e.influencesPerVertex:2;if(e.skinWeights)for(var a=0,o=e.skinWeights.length;a<o;a+=n){var r=e.skinWeights[a],i=n>1?e.skinWeights[a+1]:0,s=n>2?e.skinWeights[a+2]:0,c=n>3?e.skinWeights[a+3]:0;t.skinWeights.push(new THREE.Vector4(r,i,s,c))}if(e.skinIndices)for(a=0,o=e.skinIndices.length;a<o;a+=n){var l=e.skinIndices[a],d=n>1?e.skinIndices[a+1]:0,m=n>2?e.skinIndices[a+2]:0,u=n>3?e.skinIndices[a+3]:0;t.skinIndices.push(new THREE.Vector4(l,d,m,u))}t.bones=e.bones,t.bones&&t.bones.length>0&&(t.skinWeights.length!==t.skinIndices.length||t.skinIndices.length!==t.vertices.length)&&console.warn("When skinning, number of vertices ("+t.vertices.length+"), skinIndices ("+t.skinIndices.length+"), and skinWeights ("+t.skinWeights.length+") should match.")}(e,n),function(e,t){var n=e.scale;if(void 0!==e.morphTargets)for(var a=0,o=e.morphTargets.length;a<o;a++){t.morphTargets[a]={},t.morphTargets[a].name=e.morphTargets[a].name,t.morphTargets[a].vertices=[];for(var r=t.morphTargets[a].vertices,i=e.morphTargets[a].vertices,s=0,c=i.length;s<c;s+=3){var l=new THREE.Vector3;l.x=i[s]*n,l.y=i[s+1]*n,l.z=i[s+2]*n,r.push(l)}}if(void 0!==e.morphColors&&e.morphColors.length>0){console.warn('THREE.JSONLoader: "morphColors" no longer supported. Using them as face colors.');var d=t.faces,m=e.morphColors[0].colors;for(a=0,o=d.length;a<o;a++)d[a].color.fromArray(m,3*a)}}(e,n),function(e,t){var n=[],a=[];void 0!==e.animation&&a.push(e.animation),void 0!==e.animations&&(e.animations.length?a=a.concat(e.animations):a.push(e.animations));for(var o=0;o<a.length;o++){var r=THREE.AnimationClip.parseAnimation(a[o],t.bones);r&&n.push(r)}if(t.morphTargets){var i=THREE.AnimationClip.CreateClipsFromMorphTargetSequences(t.morphTargets,10);n=n.concat(i)}n.length>0&&(t.animations=n)}(e,n),n.computeFaceNormals(),n.computeBoundingSphere(),void 0===e.materials||0===e.materials.length?{geometry:n}:{geometry:n,materials:THREE.Loader.prototype.initMaterials(e.materials,this.resourcePath||t,this.crossOrigin)}}}()}),e}();